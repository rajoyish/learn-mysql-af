## 1.11 Generated columns

### How to Use Generated Columns in MySQL

MySQL is a versatile database management system, and one of its powerful features is **generated columns**. These columns allow you to automate calculations and other tasks by generating values based on existing data in other columns.

---

### What Are Generated Columns?

**Generated columns** are columns whose values are calculated from an expression, rather than being explicitly stored by the user. The database automatically computes these values based on other columns in the table.

- **Example**: Imagine you have a table where one column contains email addresses. You could create another column that automatically extracts the domain (e.g., `example.com`) from the email addresses. This second column is a generated column.

---

### Example: Creating a Table with Generated Columns

Letâ€™s walk through an example of creating a table with a generated column.

In this example, we'll create a table called `emails` with two columns:

1. `email`: a `varchar(255)` column that stores an email address.
2. `domain`: a generated column that automatically extracts the domain from the email address using the `substring_index()` function.

Here's the SQL code to create the table:

```sql
CREATE TABLE emails (
  email varchar(255),
  domain varchar(255) AS (substring_index(email, '@', -1))
);

INSERT INTO emails (email) value('rajesh@gmail.com');

SELECT * FROM emails;
```

In this example:
- The **`domain`** column is generated by extracting the part of the email after the `@` symbol using the **`substring_index()`** function.
- The value of `domain` is calculated dynamically based on the `email` column.

---

### Virtual vs. Stored Generated Columns

Generated columns can be **virtual** or **stored**, and understanding the difference is crucial when deciding which one to use.

1. **Virtual Columns**:
   - Values are calculated **at runtime**.
   - They **do not** take up space on the disk.
   - **Pros**: Efficient use of storage; good for columns that aren't frequently queried.
   - **Cons**: Slower retrieval time since the value has to be recalculated each time.

2. **Stored Columns**:
   - Values are calculated **when data is inserted or updated** and saved to disk.
   - **Pros**: Faster retrieval because the value is precomputed.
   - **Cons**: Takes up disk space like a regular column.

By default, generated columns are **virtual**, but you can explicitly define whether they should be **virtual** or **stored**:

```sql
-- Virtual generated column
domain varchar(255) AS (substring_index(email, '@', -1)) VIRTUAL;

-- Stored generated column
domain varchar(255) AS (substring_index(email, '@', -1)) STORED;
```

---

### Use Cases for Generated Columns

There are many practical scenarios where generated columns can simplify your database operations. Here are some examples:

1. **Extracting Data from JSON**:
   - If a column contains JSON data, a generated column can extract specific keys from the JSON object. This makes querying more efficient.
   
   Example:
   ```sql
   json_data JSON,
   user_name VARCHAR(255) AS (json_extract(json_data, '$.name')) STORED
   ```

2. **Performing Calculations**:
   - You can use generated columns to perform calculations such as tax computation, converting units, or applying discounts directly in the database.

   Example:
   ```sql
   price DECIMAL(10, 2),
   tax_price DECIMAL(10, 2) AS (price * 1.1) STORED
   ```

3. **Normalizing Data**:
   - If a column contains redundant or duplicated data, you can extract it into a new column and improve the structure of your table.

   Example:
   ```sql
   full_name VARCHAR(255),
   first_name VARCHAR(255) AS (substring_index(full_name, ' ', 1)) STORED
   ```

---

### Conclusion

Generated columns are a flexible and powerful tool in MySQL that can help automate calculations, normalize data, and improve the efficiency of your database. By using either **virtual** or **stored** generated columns, you can optimize performance based on your specific use case.

In summary:
- Generated columns are based on expressions calculated from other columns.
- You can create **virtual** (calculated at runtime) or **stored** (calculated during insert/update) columns.
- Common use cases include extracting JSON data, performing on-the-fly calculations, and normalizing redundant data.

Mastering generated columns can help you simplify and automate various tasks within your MySQL databases.